# Sustainability IoT Monorepo

A monorepo for managing IoT devices, dashboards, and AI implementations for waste management and factory sustainability monitoring.

[![CI](https://github.com/masaki-kasuga/sus/actions/workflows/ci.yml/badge.svg)](https://github.com/masaki-kasuga/sus/actions/workflows/ci.yml)
[![CodeQL](https://github.com/masaki-kasuga/sus/actions/workflows/codeql.yml/badge.svg)](https://github.com/masaki-kasuga/sus/actions/workflows/codeql.yml)

## ğŸ“ Folder Structure

```
sustainability/
â”œâ”€â”€ apps/                    # Applications
â”‚   â”œâ”€â”€ dashboard/          # Web Dashboard (Frontend)
â”‚   â”œâ”€â”€ api/                # Backend API
â”‚   â””â”€â”€ ai/                 # AI/ML Models and Services
â”‚
â”œâ”€â”€ devices/                # IoT Device Implementations
â”‚   â”œâ”€â”€ raspi/              # Raspberry Pi Programs
â”‚   â””â”€â”€ m5/                 # M5Stack/M5StickC Programs
â”‚
â”œâ”€â”€ shared/                 # Shared Libraries
â”‚   â”œâ”€â”€ types/              # Common Type Definitions
â”‚   â”œâ”€â”€ utils/              # Utility Functions
â”‚   â””â”€â”€ config/             # Configuration Files
â”‚
â””â”€â”€ docs/                   # Documentation
    â””â”€â”€ specs/              # Specifications
        â”œâ”€â”€ hardware/       # Hardware Specifications
        â””â”€â”€ api/            # API Specifications
```

## ğŸš€ Quick Start

### Prerequisites

- **Node.js** 20.20.0 or later
- **npm** 10.x or later
- **Docker & Docker Compose** (for containerized development)

### Recommended Tools

- **[mise](https://mise.jdx.dev/)** - Automatic tool version management
- **make** - Task runner (usually pre-installed on macOS/Linux)

### Installation

```bash
# Clone the repository
git clone https://github.com/masaki-kasuga/sus.git
cd sus

# Install dependencies
npm install

# Or using make
make install

# Or using mise
mise install && mise run install
```

### Development

#### Option 1: Using Make (Recommended)

```bash
# Start API
make dev-api

# Start Dashboard
make dev-dashboard

# Or use Docker for full environment
make docker-dev
```

#### Option 2: Using mise

```bash
# Start API
mise run dev-api

# Start Dashboard
mise run dev-dashboard
```

#### Option 3: Using npm directly

```bash
# Start API
npm run dev --workspace=apps/api

# Start Dashboard
npm run dev --workspace=apps/dashboard
```

### Docker Development

```bash
# Start development environment (Postgres + API + Dashboard)
make docker-dev

# View logs
make docker-dev-logs

# Stop
make docker-down
```

**Available at:**
- API: http://localhost:3000
- Dashboard: http://localhost:5173
- PostgreSQL: localhost:5432

### Quick Commands

```bash
# Linting
make lint              # Lint all
make lint-fix          # Auto-fix issues

# Building
make build             # Build all
make build-api         # Build API only
make build-dashboard   # Build Dashboard only

# Docker
make docker-dev        # Start dev environment
make docker-prod       # Start prod environment
make docker-down       # Stop containers
make docker-clean      # Clean all Docker resources

# Utilities
make help              # Show all available commands
```

For detailed development instructions, see [DEVELOPMENT.md](DEVELOPMENT.md).

## ğŸ“¦ Package Management

This monorepo uses **npm workspaces** to manage multiple packages efficiently:

- **Shared dependencies** are installed once at the root
- **Workspace-specific dependencies** are isolated per package
- **No need for `--workspaces=false` flags** - everything just works!

### Why Workspaces?

âœ… **Efficiency**: Common dependencies like TypeScript and ESLint are installed once  
âœ… **Consistency**: All packages use the same version of shared tools  
âœ… **Simplicity**: Single `npm install` command for the entire project  
âœ… **Speed**: Faster CI/CD with better caching

## ğŸ“š Documentation

- **[Development Guide](DEVELOPMENT.md)** - Detailed development instructions
- **[API Documentation](apps/api/README.md)** - API setup and usage
- **[Dashboard Documentation](apps/dashboard/README.md)** - Dashboard setup and usage
- **[API Specifications](docs/specs/api/README.md)** - API endpoint specifications
- **[Hardware Specifications](docs/specs/hardware/README.md)** - IoT device specs

## ğŸ§ª Testing

```bash
# Lint all code
make lint

# Run type checking
make build

# Run CI checks locally
make ci
```

## ğŸ³ Docker Environments

### Development Environment

Full development environment with hot reload:

```bash
make docker-dev
```

### Production Environment (Local Testing)

Test production builds locally:

```bash
make docker-prod
```

## ğŸ“‹ Available Make Commands

Run `make help` to see all available commands:

```bash
make help
```

## ğŸ”„ Release & Versioning

- Conventional Commits â†’ automated SemVer bump and changelog
- Release tags are created per app (e.g. `dashboard-v1.2.3`, `api-v1.2.3`)
- Release PRs are generated by Release Please on `main`

## ğŸ¤ Contributing

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'feat: add amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## ğŸ“„ License

MIT

## ğŸ™ Acknowledgments

- Built with Node.js, TypeScript, React, and PostgreSQL
- IoT devices: Raspberry Pi and M5Stack
